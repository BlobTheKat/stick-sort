globalThis.BitField??=class e extends Array{constructor(e){if(super(),Array.isArray(e))for(let t=0;t<e.length;t++)this.push(e[t]);else if(e instanceof Uint8Array)for(let t=0;t<e.length;t+=4)this.push(e[t]|e[1|t]<<8|e[2|t]<<16|e[3|t]<<24);else if(e)for(const t of e)this.set(t)}static parse(t){return Array.isArray(t)?Object.setPrototypeOf(t,e.prototype):new e}static decode(t,r=new e){r.length=0;let s=t.v32();for(;s--;)r.push(t.i32())}static encode(e,t){const r=t.length;e.v32(r);for(let t=0;t<r;t++)e.i32(this[t])}static of(...t){const r=new e;for(const e of t)r.set(e);return r}set(e){const t=e>>>5;for(;t>=this.length;)this.push(0);this[t]|=1<<(31&e)}unset(e){let t=this.length;const r=e>>>5;if(!(r>=t))for(this[r]&=~(1<<(31&e));t&&!this[--t];)super.pop()}toggle(e){let t=this.length;const r=e>>>5;for(;r>=t;)this.push(0),t++;for(this[r]^=1<<(31&e);t&&!this[--t];)super.pop()}has(e){const t=e>>>5;return!(t>=this.length)&&!!(this[t]&1<<(31&e))}pop(e){let t=e>>>5;if(t>=this.length)return!1;let r=this[t];if(r^=this[t]=r&~(1<<(31&e)),t==this.length-1)for(;t>=0&&!this[t--];)super.pop();return!!r}put(e){let t=e>>>5;for(;t>=this.length;)this.push(0);return!!(this[t]^(this[t]|=1<<(31&e)))}xor(e){let t=this.length;if(t==e.length)for(;t&&this[--t]==e[t];)super.pop();else{let r=t;for(t--;r<e.length;)this.push(e[r++])}for(let r=t;r>=0;r--)this[r]^=e[r]}and(e){let t=this.length;for(this.length>e.length&&(t=this.length=e.length);t&&!(this[--t]&e[t]);)super.pop();for(;t>0;)this[--t]&=e[t]}or(e){let t=this.length-1,r=t;for(;++r<e.length;)this.push(e[r]);for(let r=t;r>=0;r--)this[r]|=e[r]}firstUnset(){let e=-1;for(;++e<this.length;){const t=~this[e];if(t)return e<<5|31-clz32(t&-t)}return e<<5}firstSet(){let e=-1;for(;++e<this.length;)if(this[e])return e<<5|31-clz32(this[e]&-this[e]);return-1}lastSet(){let e=this.length;for(;--e>=0;)if(this[e])return e<<5|31-clz32(this[e]);return-1}popFirst(){let e=-1;for(;++e<this.length;)if(this[e]){let t=31-clz32(this[e]&-this[e]);for(this[e]&=~(1<<t),t|=e<<5,e=this.length;e&&!this[--e];)super.pop();return t}return-1}putFirst(){let e=-1;for(;++e<this.length;){const t=~this[e];if(!t)continue;const r=31-clz32(t&-t);return this[e]|=1<<r,e<<5|r}return this.push(1),e<<5}popLast(){let e=this.length;for(;--e>=0;)if(this[e]){let t=31-Math.clz32(this[e]);for(this[e]&=~(1<<t),t|=e<<5,e=this.length;e&&!this[--e];)super.pop();return t}return-1}clear(){this.length=0}[Symbol.iterator](){const e={value:0,done:!1};let t=0,r=-1;return{[Symbol.iterator](){return this},next:()=>{for(;t<this.length;t++,r=-1){const s=this[t]&r,o=31-clz32(s&-s);if(!(o<0))return r=-2<<o,e.value=t<<5|o,e}return t=1/0,e.done=!0,e}}}iter(e){for(let t=0;t<this.length;t++){let r=-1;for(;;){const s=this[t]&r,o=31-clz32(s&-s);if(o<0)break;r=-2<<o,e(t<<5|o)}}}[Symbol.for("nodejs.util.inspect.custom")](){let e="",t=0;for(let r=0;r<this.length;r++){let s=-1;for(;;){const o=this[r]&s,n=31-clz32(o&-o);if(n<0)break;s=-2<<n,e+=" "+(r<<5|n),t++}}return`BitField(${t}) {[33m${e} [m}`}toUint8Array(){let e=this.length-1,t=this[e],r=0;const s=new Uint8Array(e=(e<<2)+(39-clz32(t)>>3));for(;r<e;r+=4){const e=this[r>>2];s[r]=e,s[1|r]=e>>8,s[2|r]=s>>16,s[3|r]=s>>24}for(r-=4;r<e;)s[r++]=t,t>>=8;return s}},"remove"in[]||Object.defineProperty(Array.prototype,"remove",{value(e){let t=this.indexOf(e);if(t>-1){for(;t<b.length;)b[t]=b[++t];b.pop()}return t},enumerable:!1,configurable:!0});{let e=null,t=null;const r={__proto__:null,ContextMenu:93,Help:26,Semicolon:186,Quote:222,BracketLeft:219,BracketRight:221,Backquote:192,Backslash:220,Minus:189,EQUAL:187,IntlRo:193,IntlYen:255,MetaLeft:91,MetaRight:91,PrintScreen:44,ScrollLock:145,Pause:19,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,Clear:10,NumpadComma:110,NumpadDecimal:110,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105};Gamma.input=(r,s=r.canvas)=>{const o=r.keys=new BitField;r.MOUSE=Object.freeze({LEFT:0,RIGHT:2,MIDDLE:1,BACK:3,FORWARD:4}),r.KEY=Object.freeze({A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,SPACE:32,BACKTICK:192,TAB:9,BACK:8,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,META:91,METARIGHT:93,CAPSLOCK:20,UP:38,RIGHT:39,DOWN:40,LEFT:37,MOD:navigator.platform.startsWith("Mac")?91:17,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS:189,EQUAL:187,BR_LEFT:219,BR_RIGHT:221,SEMICOLON:186,APOS:222,BACKSLASH:220,COMMA:188,DOT:190,SLASH:191,PAUSE:19,PAD_ENTER:12,CLEAR:10,HOME:36,END:35,PAGE_UP:33,PAGE_DOWN:34,INS:45,DEL:46,CTX_MENU:93,PAD_0:96,PAD_1:97,PAD_2:98,PAD_3:99,PAD_4:100,PAD_5:101,PAD_6:102,PAD_7:103,PAD_8:104,PAD_9:105,PAD_DIV:111,PAD_MULT:106,PAD_SUB:109,PAD_ADD:107,PAD_DOT:110,NUM_LOCK:144,SCROLL_LOCK:145,HELP:26,RO:193,YEN:255,SYSRQ:44,PRINT_SCREEN:44}),r.REPEAT=256,r.GAMEPAD=Object.freeze({A:256,B:257,X:258,Y:259,LB:260,RB:261,LT:262,RT:263,UP:268,DOWN:269,LEFT:270,RIGHT:271,MENU:300}),r.cursor=r.vec2(.5),r.cursorDelta=r.vec2(),r.mouse=r.vec2(.5),r.wheel=r.vec2(),r.scrollDelta=r.vec2();const n=new Map;(r.onKey=(e,t)=>{if(Array.isArray(e)){for(const s of e)r.onKey(s,t);return}const s=n.get(e&=65535);s?s.push(t):n.set(e,[t])}).remove=(e,t)=>{if(Array.isArray(e)){for(const s of e)r.onKey.remove(s,t);return}const s=n.get(e&=65535);s&&(s.remove(t),!s.length)&&n.delete(e)},(r.onKeyRelease=(e,t)=>{if(Array.isArray(e)){for(const s of e)r.onKeyRelease(s,t);return}const s=n.get(e=~(65535&e));s?s.push(t):n.set(e,[t])}).remove=(e,t)=>{if(Array.isArray(e)){for(const s of e)r.onKeyRelease.remove(s,t);return}const s=n.get(e=~(65535&e));s&&(s.remove(t),!s.length)&&n.delete(e)};const i=[],l=[];(r.onWheel=e=>{i.push(e)}).remove=e=>{i.remove(e)},(r.onMouse=e=>{l.push(e)}).remove=e=>{l.remove(e)},s.style.cursor="default",Object.defineProperty(r,"cursorType",{get:()=>s.style.cursor,set(e){s.style.cursor=e||"default"}}),s.addEventListener("mouseover",(()=>{e||(e=o,t=n)})),s.addEventListener("mouseout",(()=>{if(e!=o)return;const r=new BitField(o);o.clear(),r.iter((e=>{const t=n.get(~e);if(t)for(const r of t)try{r(e)}catch(e){Promise.reject(e)}})),o.clear(),e=t=null})),s.addEventListener("mousedown",(e=>{e.preventDefault();const t=e.button;o.set(t);const r=n.get(t);if(r)for(const s of r)try{s(t)}catch(e){Promise.reject(e)}})),s.addEventListener("mouseup",(e=>{e.preventDefault();const t=e.button;if(!o.pop(t))return;const r=n.get(~t);if(r)for(const s of r)try{s(t)}catch(e){Promise.reject(e)}})),s.addEventListener("contextmenu",(e=>e.preventDefault())),s.addEventListener("wheel",(e=>{e.preventDefault(),wheel.x+=e.wheelDeltaX,wheel.y+=e.wheelDeltaY,scrollDelta.x+=e.wheelDeltaX/innerWidth,scrollDelta.y+=e.wheelDeltaY/innerHeight;for(const t of i)t(e.wheelDeltaX,e.wheelDeltaY)}),{passive:!1}),s.addEventListener("mousemove",(e=>{e.preventDefault(),mouse.x+=e.movementX,mouse.y+=e.movementY,cursor.x=e.offsetX/e.target.offsetWidth,cursor.y=1-e.offsetY/e.target.offsetHeight;for(const t of i)t(e.movementX,e.movementY)}))};const s=document;s.addEventListener("keydown",(o=>{if(!e)return;if(s.activeElement!=s.body&&s.activeElement||o.preventDefault(),o.repeat)return;const n=r[o.code]??o.keyCode;e.set(n);const i=t.get(n);if(i)for(const e of i)try{e(n)}catch(o){Promise.reject(o)}})),s.addEventListener("keyup",(o=>{if(!e)return;s.activeElement!=s.body&&s.activeElement||o.preventDefault();const n=r[o.code]??o.keyCode;if(!e.pop(n))return;const i=t.get(~n);if(i)for(const e of i)try{e(n)}catch(o){Promise.reject(o)}}))}